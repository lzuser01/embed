<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Reproductor Encriptado con Diseño Personalizado</title>
<script src="https://cdn.tailwindcss.com"></script>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
/>
<style>
  body, html {
    margin: 0; padding: 0; height: 100%; background: black; display: flex; justify-content: center; align-items: center; user-select: none;
  }
  #player-wrapper {
    position: relative;
    width: 90vw;
    max-width: 900px;
    aspect-ratio: 16 / 9;
    background: black;
  }
  video {
    width: 100%;
    height: 100%;
    background: black;
    display: block;
  }
  #fondo {
    position: absolute;
    inset: 0;
    background: url('https://image.tmdb.org/t/p/original/ApRxyHFuvv5yghedxXPJSm9FEDe.jpg') center center/cover no-repeat;
    transition: opacity 0.5s ease;
    z-index: 15;
  }
  #controls {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    color: white;
    pointer-events: auto;
    z-index: 20;
    opacity: 1;
    transition: opacity 0.3s ease;
  }
  #controls.hide {
    opacity: 0;
    pointer-events: none;
  }

  /* Top bar */
  #top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.9rem;
    margin-bottom: 5rem;
    position: relative;
    z-index: 20;
  }
  #top-bar button {
    background: transparent;
    border: none;
    color: white;
    cursor: pointer;
  }

  /* Middle controls */
  #middle-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 5rem;
    margin-bottom: 5rem;
    position: relative;
    z-index: 20;
  }
  #middle-controls button {
    background: transparent;
    border: none;
    color: white;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: 1.8rem;
    position: relative;
    transition: transform 0.2s ease;
  }
  #middle-controls button:hover {
    transform: scale(1.2);
  }
  #middle-controls .btn-text {
    font-size: 0.7rem;
    font-weight: 700;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
    user-select: none;
  }
  #middle-controls button#playPauseBtn {
    font-size: 3rem;
    flex-direction: row;
    align-items: center;
  }
  #middle-controls button#playPauseBtn i {
    pointer-events: none;
  }

  /* Progress bar and time */
  #progress-container {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2rem;
    position: relative;
    z-index: 20;
  }
  #progressBar {
    flex: 1;
    height: 4px;
    background: #444;
    border-radius: 2px;
    position: relative;
    cursor: pointer;
  }
  #progressIndicator {
    height: 100%;
    background: red;
    width: 0%;
    border-radius: 2px 0 0 2px;
    transition: width 0.15s linear;
  }
  #durationDisplay {
    font-size: 0.75rem;
    width: 5.5rem;
    text-align: right;
    user-select: none;
  }
</style>
</head>
<body>
<div id="player-wrapper" tabindex="0">
  <video id="video" preload="metadata" playsinline controlsList="nodownload"></video>
  <div id="fondo"></div>

  <div id="controls">
    <div id="top-bar">
      <button id="fullscreenBtn" aria-label="Toggle fullscreen" title="Pantalla completa">
        <i class="fas fa-expand fa-lg"></i>
      </button>
      <button
        aria-label="Screen lock toggle"
        class="text-white text-2xl leading-none flex items-center justify-center w-8 h-8"
        id="lockButton"
        title="Bloquear pantalla"
      >
        <i class="fas fa-lock"></i>
      </button>
    </div>

    <div id="middle-controls">
      <button
        aria-label="Retroceder 10 segundos"
        id="rewindBtn"
        title="Retroceder 10 segundos"
      >
        <svg
          class="absolute inset-0 w-10 h-10"
          fill="none"
          stroke="white"
          stroke-width="2"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M15.75 10.5L12 7.5m0 0L8.25 10.5M12 7.5v9"
          ></path>
          <circle cx="12" cy="12" r="9" stroke="white" stroke-width="2" />
        </svg>
        <div
          class="btn-text"
        >
          10
        </div>
      </button>

      <button id="playPauseBtn" aria-label="Play/Pause" title="Reproducir/Pausar">
        <i class="fas fa-play"></i>
      </button>

      <button
        aria-label="Adelantar 10 segundos"
        id="forwardBtn"
        title="Adelantar 10 segundos"
      >
        <svg
          class="absolute inset-0 w-10 h-10"
          fill="none"
          stroke="white"
          stroke-width="2"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M8.25 13.5L12 16.5m0 0L15.75 13.5M12 16.5v-9"
          ></path>
          <circle cx="12" cy="12" r="9" stroke="white" stroke-width="2" />
        </svg>
        <div
          class="btn-text"
        >
          10
        </div>
      </button>
    </div>

    <div id="progress-container">
      <div id="progressBar" aria-label="Barra de progreso" role="slider" tabindex="0">
        <div id="progressIndicator"></div>
      </div>
      <div id="durationDisplay">0:00</div>
    </div>
  </div>
</div>

<script>
  // Obtener y decodificar parámetro base64
  function obtenerParametro(nombre) {
    var params = new URLSearchParams(window.location.search);
    return params.get(nombre);
  }

  const video = document.getElementById('video');
  const fondo = document.getElementById('fondo');
  const controls = document.getElementById('controls');
  const playPauseBtn = document.getElementById('playPauseBtn');
  const rewindBtn = document.getElementById('rewindBtn');
  const forwardBtn = document.getElementById('forwardBtn');
  const progressBar = document.getElementById('progressBar');
  const progressIndicator = document.getElementById('progressIndicator');
  const durationDisplay = document.getElementById('durationDisplay');
  const fullscreenBtn = document.getElementById('fullscreenBtn');
  const lockButton = document.getElementById('lockButton');

  var isLocked = false;
  var hideTimeout;

  function formatTime(s) {
    const m = Math.floor(s / 60);
    const sec = Math.floor(s % 60);
    return m + ':' + (sec < 10 ? '0' + sec : sec);
  }

  function showControls() {
    if (isLocked) return; // Si está bloqueado no mostrar controles
    controls.classList.remove('hide');
    if (hideTimeout) clearTimeout(hideTimeout);
    hideTimeout = setTimeout(() => {
      controls.classList.add('hide');
    }, 5000);
  }

  function updatePlayPauseIcon() {
    if (video.paused) {
      playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
      fondo.style.opacity = '1';
    } else {
      playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
      fondo.style.opacity = '0';
    }
  }

  playPauseBtn.addEventListener('click', () => {
    if (video.paused) video.play();
    else video.pause();
    showControls();
  });

  rewindBtn.addEventListener('click', () => {
    video.currentTime = Math.max(video.currentTime - 10, 0);
    showControls();
  });

  forwardBtn.addEventListener('click', () => {
    video.currentTime = Math.min(video.currentTime + 10, video.duration);
    showControls();
  });

  video.addEventListener('timeupdate', () => {
    if (!video.duration) return;
    const percent = (video.currentTime / video.duration) * 100;
    progressIndicator.style.width = percent + '%';
    durationDisplay.textContent = formatTime(video.currentTime) + ' / ' + formatTime(video.duration);
  });

  progressBar.addEventListener('click', (e) => {
    const rect = progressBar.getBoundingClientRect();
    const clickX = e.clientX - rect.left;
    const newTime = (clickX / rect.width) * video.duration;
    video.currentTime = newTime;
    showControls();
  });

  ['mousemove', 'touchstart'].forEach(evt => {
    document.addEventListener(evt, showControls);
  });

  document.addEventListener('click', (e) => {
    if (!controls.contains(e.target) && e.target !== fullscreenBtn) {
      controls.classList.add('hide');
    }
  });

  fullscreenBtn.addEventListener('click', () => {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen();
      fullscreenBtn.querySelector('i').className = 'fas fa-compress fa-lg';
    } else {
      document.exitFullscreen();
      fullscreenBtn.querySelector('i').className = 'fas fa-expand fa-lg';
    }
    showControls();
  });

  document.addEventListener('fullscreenchange', () => {
    if (!document.fullscreenElement) {
      fullscreenBtn.querySelector('i').className = 'fas fa-expand fa-lg';
    } else {
      fullscreenBtn.querySelector('i').className = 'fas fa-compress fa-lg';
    }
  });

  lockButton.addEventListener('click', () => {
    isLocked = !isLocked;
    if (isLocked) {
      controls.classList.add('hide');
      lockButton.innerHTML = '<i class="fas fa-lock-open"></i>';
    } else {
      controls.classList.remove('hide');
      lockButton.innerHTML = '<i class="fas fa-lock"></i>';
      showControls();
    }
  });

  // Cargar video desencriptado
  const base64video = obtenerParametro('video');
  if (base64video) {
    try {
      const url = atob(base64video);
      video.src = url;
      video.load();
    } catch {
      alert('Error al cargar el video.');
    }
  } else {
    alert('No se encontró el parámetro de video.');
  }

  updatePlayPauseIcon();
  showControls();
</script>
</body>
</html>
